import {
  ApplicationAddressTypeEnum,
  ApplicationMethodsTypeEnum,
  DepositTypeEnum,
  HomeTypeEnum,
  LanguagesEnum,
  ListingEventsTypeEnum,
  ListingsStatusEnum,
  ListingTypeEnum,
  LotteryStatusEnum,
  MarketingSeasonEnum,
  MarketingTypeEnum,
  MonthEnum,
  MonthlyRentDeterminationTypeEnum,
  RegionEnum,
  RentTypeEnum,
  ReviewOrderTypeEnum,
  UnitAccessibilityPriorityTypeEnum,
  UnitsStatusEnum,
} from '@prisma/client';
import { PrismaService } from '../../../src/services/prisma.service';
import { randomUUID } from 'crypto';
import { SnapshotCreateService } from '../../../src/services/snapshot-create.service';
import { Test, TestingModule } from '@nestjs/testing';

describe('Testing snapshot create service', () => {
  let service: SnapshotCreateService;
  let prisma: PrismaService;

  beforeAll(async () => {
    const module: TestingModule = await Test.createTestingModule({
      imports: [],
      providers: [PrismaService, SnapshotCreateService],
    }).compile();

    service = module.get<SnapshotCreateService>(SnapshotCreateService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  afterEach(() => {
    jest.resetAllMocks();
  });

  describe('testing createUserSnapshot', () => {
    it('should create snapshot for user with no ancilliary data', async () => {
      const id = randomUUID();
      const createdAt = new Date();
      const updatedAt = new Date();

      prisma.userAccounts.findUnique = jest.fn().mockResolvedValue({
        id,
        createdAt,
        updatedAt,

        additionalPhoneExtension: 'example additionalPhoneExtension',
        additionalPhoneNumber: 'example additionalPhoneNumber',
        additionalPhoneNumberType: 'example additionalPhoneNumberType',
        agreedToTermsOfService: true,
        confirmedAt: new Date(),
        dob: new Date(),
        email: 'example email',
        firstName: 'example firstName',
        hitConfirmationUrl: new Date(),
        isAdvocate: true,
        isApproved: true,
        language: LanguagesEnum.en,
        lastLoginAt: new Date(),
        lastName: 'example lastName',
        mfaEnabled: false,
        middleName: 'example middleName',
        passwordHash: 'example passwordHash',
        passwordUpdatedAt: new Date(),
        passwordValidForDays: 30,
        phoneExtension: 'example phoneExtension',
        phoneNumber: 'example phoneNumber',
        phoneNumberVerified: true,
        phoneType: 'example phoneType',
        title: 'example title',
        wasWarnedOfDeletion: false,
      });
      prisma.userAccountSnapshot.create = jest.fn().mockResolvedValue({ id });

      await service.createUserSnapshot(id);

      expect(prisma.userAccounts.findUnique).toHaveBeenCalledWith({
        where: {
          id,
        },
        select: {
          id: true,
          createdAt: true,
          updatedAt: true,
          additionalPhoneExtension: true,
          additionalPhoneNumber: true,
          additionalPhoneNumberType: true,
          agreedToTermsOfService: true,
          confirmedAt: true,
          dob: true,
          email: true,
          firstName: true,
          hitConfirmationUrl: true,
          isAdvocate: true,
          isApproved: true,
          language: true,
          lastLoginAt: true,
          lastName: true,
          mfaEnabled: true,
          middleName: true,
          passwordHash: true,
          passwordUpdatedAt: true,
          passwordValidForDays: true,
          phoneExtension: true,
          phoneNumber: true,
          phoneNumberVerified: true,
          phoneType: true,
          title: true,
          wasWarnedOfDeletion: true,

          address: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          agency: {
            select: {
              id: true,
            },
          },
          jurisdictions: {
            select: {
              id: true,
            },
          },
          listings: {
            select: {
              id: true,
            },
          },
          userRoles: {
            select: {
              isAdmin: true,
              isJurisdictionalAdmin: true,
              isLimitedJurisdictionalAdmin: true,
              isPartner: true,
              isSuperAdmin: true,
              isSupportAdmin: true,
            },
          },
        },
      });
      expect(prisma.userAccountSnapshot.create).toHaveBeenCalledWith({
        data: {
          originalId: id,
          originalCreatedAt: createdAt,
          updatedAt,

          additionalPhoneExtension: 'example additionalPhoneExtension',
          additionalPhoneNumber: 'example additionalPhoneNumber',
          additionalPhoneNumberType: 'example additionalPhoneNumberType',
          agreedToTermsOfService: true,
          confirmedAt: expect.anything(),
          dob: expect.anything(),
          email: 'example email',
          firstName: 'example firstName',
          hitConfirmationUrl: expect.anything(),
          isAdvocate: true,
          isApproved: true,
          language: LanguagesEnum.en,
          lastLoginAt: expect.anything(),
          lastName: 'example lastName',
          mfaEnabled: false,
          middleName: 'example middleName',
          passwordHash: 'example passwordHash',
          passwordUpdatedAt: expect.anything(),
          passwordValidForDays: 30,
          phoneExtension: 'example phoneExtension',
          phoneNumber: 'example phoneNumber',
          phoneNumberVerified: true,
          phoneType: 'example phoneType',
          title: 'example title',
          wasWarnedOfDeletion: false,
        },
      });
    });
    it('should create snapshot for user with full ancilliary data', async () => {
      const id = randomUUID();
      const createdAt = new Date();
      const updatedAt = new Date();

      const addressId = randomUUID();
      const agencyId = randomUUID();

      const listingAId = randomUUID();
      const listingBId = randomUUID();

      const jurisdictionAId = randomUUID();
      const jurisdictionBId = randomUUID();

      prisma.userAccounts.findUnique = jest.fn().mockResolvedValue({
        id,
        createdAt,
        updatedAt,

        additionalPhoneExtension: 'example additionalPhoneExtension',
        additionalPhoneNumber: 'example additionalPhoneNumber',
        additionalPhoneNumberType: 'example additionalPhoneNumberType',
        agreedToTermsOfService: true,
        confirmedAt: new Date(),
        dob: new Date(),
        email: 'example email',
        firstName: 'example firstName',
        hitConfirmationUrl: new Date(),
        isAdvocate: true,
        isApproved: true,
        language: LanguagesEnum.en,
        lastLoginAt: new Date(),
        lastName: 'example lastName',
        mfaEnabled: false,
        middleName: 'example middleName',
        passwordHash: 'example passwordHash',
        passwordUpdatedAt: new Date(),
        passwordValidForDays: 30,
        phoneExtension: 'example phoneExtension',
        phoneNumber: 'example phoneNumber',
        phoneNumberVerified: true,
        phoneType: 'example phoneType',
        title: 'example title',
        wasWarnedOfDeletion: false,

        address: {
          id: addressId,
          createdAt,
          updatedAt,

          city: 'example city',
          county: 'example county',
          latitude: 10.1,
          longitude: 1.1,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        agency: {
          id: agencyId,
        },
        jurisdictions: [
          {
            id: jurisdictionAId,
          },
          {
            id: jurisdictionBId,
          },
        ],
        listings: [
          {
            id: listingAId,
          },
          {
            id: listingBId,
          },
        ],
        userRoles: {
          isAdmin: false,
          isJurisdictionalAdmin: false,
          isLimitedJurisdictionalAdmin: false,
          isPartner: false,
          isSuperAdmin: true,
          isSupportAdmin: false,
        },
      });
      prisma.userAccountSnapshot.create = jest.fn().mockResolvedValue({ id });

      await service.createUserSnapshot(id);

      expect(prisma.userAccounts.findUnique).toHaveBeenCalledWith({
        where: {
          id,
        },
        select: {
          id: true,
          createdAt: true,
          updatedAt: true,
          additionalPhoneExtension: true,
          additionalPhoneNumber: true,
          additionalPhoneNumberType: true,
          agreedToTermsOfService: true,
          confirmedAt: true,
          dob: true,
          email: true,
          firstName: true,
          hitConfirmationUrl: true,
          isAdvocate: true,
          isApproved: true,
          language: true,
          lastLoginAt: true,
          lastName: true,
          mfaEnabled: true,
          middleName: true,
          passwordHash: true,
          passwordUpdatedAt: true,
          passwordValidForDays: true,
          phoneExtension: true,
          phoneNumber: true,
          phoneNumberVerified: true,
          phoneType: true,
          title: true,
          wasWarnedOfDeletion: true,

          address: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          agency: {
            select: {
              id: true,
            },
          },
          jurisdictions: {
            select: {
              id: true,
            },
          },
          listings: {
            select: {
              id: true,
            },
          },
          userRoles: {
            select: {
              isAdmin: true,
              isJurisdictionalAdmin: true,
              isLimitedJurisdictionalAdmin: true,
              isPartner: true,
              isSuperAdmin: true,
              isSupportAdmin: true,
            },
          },
        },
      });
      expect(prisma.userAccountSnapshot.create).toHaveBeenCalledWith({
        data: {
          originalId: id,
          originalCreatedAt: createdAt,
          updatedAt,

          additionalPhoneExtension: 'example additionalPhoneExtension',
          additionalPhoneNumber: 'example additionalPhoneNumber',
          additionalPhoneNumberType: 'example additionalPhoneNumberType',
          agreedToTermsOfService: true,
          confirmedAt: expect.anything(),
          dob: expect.anything(),
          email: 'example email',
          firstName: 'example firstName',
          hitConfirmationUrl: expect.anything(),
          isAdvocate: true,
          isApproved: true,
          language: LanguagesEnum.en,
          lastLoginAt: expect.anything(),
          lastName: 'example lastName',
          mfaEnabled: false,
          middleName: 'example middleName',
          passwordHash: 'example passwordHash',
          passwordUpdatedAt: expect.anything(),
          passwordValidForDays: 30,
          phoneExtension: 'example phoneExtension',
          phoneNumber: 'example phoneNumber',
          phoneNumberVerified: true,
          phoneType: 'example phoneType',
          title: 'example title',
          wasWarnedOfDeletion: false,

          address: {
            create: {
              originalId: addressId,
              originalCreatedAt: createdAt,
              updatedAt,

              city: 'example city',
              county: 'example county',
              latitude: 10.1,
              longitude: 1.1,
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              zipCode: 'example zipCode',
            },
          },
          agency: {
            connect: {
              id: agencyId,
            },
          },
          jurisdiction: {
            connect: [
              {
                id: jurisdictionAId,
              },
              {
                id: jurisdictionBId,
              },
            ],
          },
          listing: {
            connect: [
              {
                id: listingAId,
              },
              {
                id: listingBId,
              },
            ],
          },
          userRole: {
            create: {
              isAdmin: false,
              isJurisdictionalAdmin: false,
              isLimitedJurisdictionalAdmin: false,
              isPartner: false,
              isSuperAdmin: true,
              isSupportAdmin: false,
            },
          },
        },
      });
    });
    it('should error when trying to create snapshot against user id that does not exist', async () => {
      const id = randomUUID();

      prisma.userAccounts.findUnique = jest.fn().mockResolvedValue(null);
      prisma.userAccountSnapshot.create = jest.fn().mockResolvedValue({ id });

      await expect(
        async () => await service.createUserSnapshot(id),
      ).rejects.toThrowError(
        `Snapshot was requested for user id: ${id}, but that id does not exist`,
      );

      expect(prisma.userAccounts.findUnique).toHaveBeenCalledWith({
        where: {
          id,
        },
        select: {
          id: true,
          createdAt: true,
          updatedAt: true,
          additionalPhoneExtension: true,
          additionalPhoneNumber: true,
          additionalPhoneNumberType: true,
          agreedToTermsOfService: true,
          confirmedAt: true,
          dob: true,
          email: true,
          firstName: true,
          hitConfirmationUrl: true,
          isAdvocate: true,
          isApproved: true,
          language: true,
          lastLoginAt: true,
          lastName: true,
          mfaEnabled: true,
          middleName: true,
          passwordHash: true,
          passwordUpdatedAt: true,
          passwordValidForDays: true,
          phoneExtension: true,
          phoneNumber: true,
          phoneNumberVerified: true,
          phoneType: true,
          title: true,
          wasWarnedOfDeletion: true,

          address: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          agency: {
            select: {
              id: true,
            },
          },
          jurisdictions: {
            select: {
              id: true,
            },
          },
          listings: {
            select: {
              id: true,
            },
          },
          userRoles: {
            select: {
              isAdmin: true,
              isJurisdictionalAdmin: true,
              isLimitedJurisdictionalAdmin: true,
              isPartner: true,
              isSuperAdmin: true,
              isSupportAdmin: true,
            },
          },
        },
      });
      expect(prisma.userAccountSnapshot.create).not.toHaveBeenCalled();
    });
  });

  describe('testing createListingSnapshot', () => {
    it('should create snapshot for listing with no ancilliary data', async () => {
      const id = randomUUID();
      const createdAt = new Date();
      const updatedAt = new Date();

      prisma.listings.findUnique = jest.fn().mockResolvedValue({
        id,
        createdAt,
        updatedAt,

        accessibility: 'example accessibility',
        accessibleMarketingFlyer: 'example accessibleMarketingFlyer',
        additionalApplicationSubmissionNotes:
          'example additionalApplicationSubmissionNotes',
        allowsCats: true,
        allowsDogs: true,
        amenities: 'example amenities',
        amiPercentageMax: 1,
        amiPercentageMin: 2,
        applicationDropOffAddressOfficeHours:
          'example applicationDropOffAddressOfficeHours',
        applicationDropOffAddressType: ApplicationAddressTypeEnum.leasingAgent,
        applicationDueDate: new Date(),
        applicationFee: 'example applicationFee',
        applicationMailingAddressType: ApplicationAddressTypeEnum.leasingAgent,
        applicationOpenDate: new Date(),
        applicationOrganization: 'example applicationOrganization',
        applicationPickUpAddressOfficeHours:
          'example applicationPickUpAddressOfficeHours',
        applicationPickUpAddressType: ApplicationAddressTypeEnum.leasingAgent,
        assets: '[]',
        buildingSelectionCriteria: 'example buildingSelectionCriteria',
        buildingTotalUnits: 10,
        closedAt: new Date(),
        cocInfo: 'example cocInfo',
        commonDigitalApplication: true,
        communityDisclaimerDescription:
          'example communityDisclaimerDescription',
        communityDisclaimerTitle: 'example communityDisclaimerTitle',
        configurableRegion: 'example configurableRegion',
        contentUpdatedAt: new Date(),
        costsNotIncluded: 'example costsNotIncluded',
        creditHistory: 'example creditHistory',
        creditScreeningFee: 'example creditScreeningFee',
        criminalBackground: 'example criminalBackground',
        customMapPin: true,
        depositHelperText: 'example depositHelperText',
        depositMax: 'example depositMax',
        depositMin: 'example depositMin',
        depositType: DepositTypeEnum.fixedDeposit,
        depositValue: 10.01,
        developer: 'example developer',
        digitalApplication: true,
        disableUnitsAccordion: true,
        displayWaitlistSize: true,
        hasHudEbllClearance: true,
        homeType: HomeTypeEnum.apartment,
        householdSizeMax: 5,
        householdSizeMin: 1,
        hrdId: 'example hrdId',
        includeCommunityDisclaimer: true,
        isVerified: true,
        isWaitlistOpen: true,
        leasingAgentEmail: 'example leasingAgentEmail',
        leasingAgentName: 'example leasingAgentName',
        leasingAgentOfficeHours: 'example leasingAgentOfficeHours',
        leasingAgentPhone: 'example leasingAgentPhone',
        leasingAgentTitle: 'example leasingAgentTitle',
        listingFileNumber: 'example listingFileNumber',
        listingType: ListingTypeEnum.regulated,
        lotteryLastPublishedAt: new Date(),
        lotteryLastRunAt: new Date(),
        lotteryOptIn: true,
        lotteryStatus: LotteryStatusEnum.ran,
        managementCompany: 'example managementCompany',
        managementWebsite: 'example managementWebsite',
        marketingFlyer: 'example marketingFlyer',
        marketingMonth: MonthEnum.january,
        marketingSeason: MarketingSeasonEnum.spring,
        marketingType: MarketingTypeEnum.marketing,
        marketingYear: 2026,
        name: 'example name',
        neighborhood: 'example neighborhood',
        ownerCompany: 'example ownerCompany',
        paperApplication: true,
        parkingFee: 'example parkingFee',
        petPolicy: 'example petPolicy',
        phoneNumber: 'example phoneNumber',
        postmarkedApplicationsReceivedByDate: new Date(),
        programRules: 'example programRules',
        publishedAt: new Date(),
        referralOpportunity: true,
        region: RegionEnum.Greater_Downtown,
        rentalAssistance: 'example rentalAssistance',
        rentalHistory: 'example rentalHistory',
        requestedChanges: 'example requestedChanges',
        requestedChangesDate: new Date(),
        requiredDocuments: 'example requiredDocuments',
        reservedCommunityDescription: 'example reservedCommunityDescription',
        reservedCommunityMinAge: 50,
        resultLink: 'example resultLink',
        reviewOrderType: ReviewOrderTypeEnum.lottery,
        section8Acceptance: true,
        servicesOffered: 'example servicesOffered',
        smokingPolicy: 'example smokingPolicy',
        specialNotes: 'example specialNotes',
        status: ListingsStatusEnum.active,
        temporaryListingId: 58,
        unitAmenities: 'example unitAmenities',
        unitsAvailable: 60,
        verifiedAt: new Date(),
        waitlistCurrentSize: 1,
        waitlistMaxSize: 2,
        waitlistOpenSpots: 3,
        wasCreatedExternally: true,
        whatToExpect: 'example whatToExpect',
        whatToExpectAdditionalText: 'example whatToExpectAdditionalText',
        yearBuilt: 2026,
      });
      prisma.listingSnapshot.create = jest.fn().mockResolvedValue({ id });

      await service.createListingSnapshot(id);

      expect(prisma.listings.findUnique).toHaveBeenCalledWith({
        where: {
          id,
        },
        select: {
          id: true,
          createdAt: true,
          updatedAt: true,
          accessibility: true,
          accessibleMarketingFlyer: true,
          additionalApplicationSubmissionNotes: true,
          allowsCats: true,
          allowsDogs: true,
          amenities: true,
          amiPercentageMax: true,
          amiPercentageMin: true,
          applicationDropOffAddressOfficeHours: true,
          applicationDropOffAddressType: true,
          applicationDueDate: true,
          applicationFee: true,
          applicationMailingAddressType: true,
          applicationOpenDate: true,
          applicationOrganization: true,
          applicationPickUpAddressOfficeHours: true,
          applicationPickUpAddressType: true,
          assets: true,
          buildingSelectionCriteria: true,
          buildingTotalUnits: true,
          closedAt: true,
          cocInfo: true,
          commonDigitalApplication: true,
          communityDisclaimerDescription: true,
          communityDisclaimerTitle: true,
          configurableRegion: true,
          contentUpdatedAt: true,
          costsNotIncluded: true,
          creditHistory: true,
          creditScreeningFee: true,
          criminalBackground: true,
          customMapPin: true,
          depositHelperText: true,
          depositMax: true,
          depositMin: true,
          depositType: true,
          depositValue: true,
          developer: true,
          digitalApplication: true,
          disableUnitsAccordion: true,
          displayWaitlistSize: true,
          hasHudEbllClearance: true,
          homeType: true,
          householdSizeMax: true,
          householdSizeMin: true,
          hrdId: true,
          includeCommunityDisclaimer: true,
          isVerified: true,
          isWaitlistOpen: true,
          leasingAgentEmail: true,
          leasingAgentName: true,
          leasingAgentOfficeHours: true,
          leasingAgentPhone: true,
          leasingAgentTitle: true,
          listingFileNumber: true,
          listingType: true,
          lotteryLastPublishedAt: true,
          lotteryLastRunAt: true,
          lotteryOptIn: true,
          lotteryStatus: true,
          managementCompany: true,
          managementWebsite: true,
          marketingFlyer: true,
          marketingMonth: true,
          marketingSeason: true,
          marketingType: true,
          marketingYear: true,
          name: true,
          neighborhood: true,
          ownerCompany: true,
          paperApplication: true,
          parkingFee: true,
          petPolicy: true,
          phoneNumber: true,
          postmarkedApplicationsReceivedByDate: true,
          programRules: true,
          publishedAt: true,
          referralOpportunity: true,
          region: true,
          rentalAssistance: true,
          rentalHistory: true,
          requestedChanges: true,
          requestedChangesDate: true,
          requiredDocuments: true,
          reservedCommunityDescription: true,
          reservedCommunityMinAge: true,
          resultLink: true,
          reviewOrderType: true,
          section8Acceptance: true,
          servicesOffered: true,
          smokingPolicy: true,
          specialNotes: true,
          status: true,
          temporaryListingId: true,
          unitAmenities: true,
          unitsAvailable: true,
          verifiedAt: true,
          waitlistCurrentSize: true,
          waitlistMaxSize: true,
          waitlistOpenSpots: true,
          wasCreatedExternally: true,
          whatToExpect: true,
          whatToExpectAdditionalText: true,
          yearBuilt: true,

          applicationMethods: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              acceptsPostmarkedApplications: true,
              externalReference: true,
              label: true,
              phoneNumber: true,
              type: true,
              paperApplications: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  language: true,
                  assets: {
                    select: {
                      id: true,
                      createdAt: true,
                      updatedAt: true,
                      fileId: true,
                      label: true,
                    },
                  },
                },
              },
            },
          },
          jurisdictions: {
            select: {
              id: true,
            },
          },
          reservedCommunityTypes: {
            select: {
              id: true,
            },
          },
          listingFeatures: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              accessibleHeightToilet: true,
              accessibleParking: true,
              acInUnit: true,
              barrierFreeBathroom: true,
              barrierFreeEntrance: true,
              barrierFreePropertyEntrance: true,
              barrierFreeUnitEntrance: true,
              bathGrabBarsOrReinforcements: true,
              bathroomCounterLowered: true,
              brailleSignageInBuilding: true,
              carbonMonoxideDetectorWithStrobe: true,
              carpetInUnit: true,
              elevator: true,
              extraAudibleCarbonMonoxideDetector: true,
              extraAudibleSmokeDetector: true,
              fireSuppressionSprinklerSystem: true,
              frontControlsDishwasher: true,
              frontControlsStoveCookTop: true,
              grabBars: true,
              hardFlooringInUnit: true,
              hearing: true,
              hearingAndVision: true,
              heatingInUnit: true,
              inUnitWasherDryer: true,
              kitchenCounterLowered: true,
              laundryInBuilding: true,
              leverHandlesOnDoors: true,
              leverHandlesOnFaucets: true,
              loweredCabinets: true,
              loweredLightSwitch: true,
              mobility: true,
              noEntryStairs: true,
              nonDigitalKitchenAppliances: true,
              noStairsToParkingSpots: true,
              noStairsWithinUnit: true,
              parkingOnSite: true,
              refrigeratorWithBottomDoorFreezer: true,
              rollInShower: true,
              serviceAnimalsAllowed: true,
              smokeDetectorWithStrobe: true,
              streetLevelEntrance: true,
              toiletGrabBarsOrReinforcements: true,
              ttyAmplifiedPhone: true,
              turningCircleInBathrooms: true,
              visual: true,
              walkInShower: true,
              wheelchairRamp: true,
              wideDoorways: true,
            },
          },
          listingNeighborhoodAmenities: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              busStops: true,
              groceryStores: true,
              healthCareResources: true,
              hospitals: true,
              parksAndCommunityCenters: true,
              pharmacies: true,
              playgrounds: true,
              publicTransportation: true,
              recreationalFacilities: true,
              schools: true,
              seniorCenters: true,
              shoppingVenues: true,
            },
          },
          listingsApplicationDropOffAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsApplicationMailingAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsApplicationPickUpAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsBuildingAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsLeasingAgentAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsAccessibleMarketingFlyerFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsBuildingSelectionCriteriaFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsMarketingFlyerFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsResult: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingMultiselectQuestions: {
            select: {
              multiselectQuestionId: true,
              ordinal: true,
            },
          },
          listingUtilities: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              cable: true,
              electricity: true,
              gas: true,
              internet: true,
              phone: true,
              sewer: true,
              trash: true,
              water: true,
            },
          },
          listingImages: {
            select: {
              assets: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  fileId: true,
                  label: true,
                },
              },
              description: true,
              ordinal: true,
            },
          },
          listingEvents: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              endTime: true,
              label: true,
              note: true,
              startDate: true,
              startTime: true,
              type: true,
              url: true,
              assets: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  fileId: true,
                  label: true,
                },
              },
            },
          },
          property: {
            select: {
              id: true,
            },
          },
          requiredDocumentsList: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              birthCertificate: true,
              currentLandlordReference: true,
              governmentIssuedId: true,
              previousLandlordReference: true,
              proofOfAssets: true,
              proofOfCustody: true,
              proofOfIncome: true,
              residencyDocuments: true,
              socialSecurityCard: true,
            },
          },
          unitGroups: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              bathroomMax: true,
              bathroomMin: true,
              flatRentValueFrom: true,
              flatRentValueTo: true,
              floorMax: true,
              floorMin: true,
              maxOccupancy: true,
              minOccupancy: true,
              monthlyRent: true,
              openWaitlist: true,
              accessibilityPriorityType: true,
              rentType: true,
              sqFeetMax: true,
              sqFeetMin: true,
              totalAvailable: true,
              totalCount: true,
              unitGroupAmiLevels: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  amiPercentage: true,
                  flatRentValue: true,
                  monthlyRentDeterminationType: true,
                  percentageOfIncomeValue: true,
                  amiChart: {
                    select: {
                      id: true,
                    },
                  },
                },
              },
              unitTypes: {
                select: {
                  id: true,
                },
              },
            },
          },
          units: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              amiPercentage: true,
              annualIncomeMax: true,
              annualIncomeMin: true,
              bmrProgramChart: true,
              floor: true,
              maxOccupancy: true,
              minOccupancy: true,
              monthlyIncomeMin: true,
              monthlyRent: true,
              monthlyRentAsPercentOfIncome: true,
              numBathrooms: true,
              numBedrooms: true,
              number: true,
              accessibilityPriorityType: true,
              sqFeet: true,
              status: true,
              amiChart: {
                select: {
                  id: true,
                },
              },
              unitAmiChartOverrides: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  items: true,
                },
              },
              unitRentTypes: {
                select: {
                  id: true,
                },
              },
              unitTypes: {
                select: {
                  id: true,
                },
              },
            },
          },
        },
      });
      expect(prisma.listingSnapshot.create).toHaveBeenCalledWith({
        data: {
          originalId: id,
          originalCreatedAt: createdAt,
          updatedAt,

          accessibility: 'example accessibility',
          accessibleMarketingFlyer: 'example accessibleMarketingFlyer',
          additionalApplicationSubmissionNotes:
            'example additionalApplicationSubmissionNotes',
          allowsCats: true,
          allowsDogs: true,
          amenities: 'example amenities',
          amiPercentageMax: 1,
          amiPercentageMin: 2,
          applicationDropOffAddressOfficeHours:
            'example applicationDropOffAddressOfficeHours',
          applicationDropOffAddressType:
            ApplicationAddressTypeEnum.leasingAgent,
          applicationDueDate: expect.anything(),
          applicationFee: 'example applicationFee',
          applicationMailingAddressType:
            ApplicationAddressTypeEnum.leasingAgent,
          applicationOpenDate: expect.anything(),
          applicationOrganization: 'example applicationOrganization',
          applicationPickUpAddressOfficeHours:
            'example applicationPickUpAddressOfficeHours',
          applicationPickUpAddressType: ApplicationAddressTypeEnum.leasingAgent,
          assets: '[]',
          buildingSelectionCriteria: 'example buildingSelectionCriteria',
          buildingTotalUnits: 10,
          closedAt: expect.anything(),
          cocInfo: 'example cocInfo',
          commonDigitalApplication: true,
          communityDisclaimerDescription:
            'example communityDisclaimerDescription',
          communityDisclaimerTitle: 'example communityDisclaimerTitle',
          configurableRegion: 'example configurableRegion',
          contentUpdatedAt: expect.anything(),
          costsNotIncluded: 'example costsNotIncluded',
          creditHistory: 'example creditHistory',
          creditScreeningFee: 'example creditScreeningFee',
          criminalBackground: 'example criminalBackground',
          customMapPin: true,
          depositHelperText: 'example depositHelperText',
          depositMax: 'example depositMax',
          depositMin: 'example depositMin',
          depositType: DepositTypeEnum.fixedDeposit,
          depositValue: 10.01,
          developer: 'example developer',
          digitalApplication: true,
          disableUnitsAccordion: true,
          displayWaitlistSize: true,
          hasHudEbllClearance: true,
          homeType: HomeTypeEnum.apartment,
          householdSizeMax: 5,
          householdSizeMin: 1,
          hrdId: 'example hrdId',
          includeCommunityDisclaimer: true,
          isVerified: true,
          isWaitlistOpen: true,
          leasingAgentEmail: 'example leasingAgentEmail',
          leasingAgentName: 'example leasingAgentName',
          leasingAgentOfficeHours: 'example leasingAgentOfficeHours',
          leasingAgentPhone: 'example leasingAgentPhone',
          leasingAgentTitle: 'example leasingAgentTitle',
          listingFileNumber: 'example listingFileNumber',
          listingType: ListingTypeEnum.regulated,
          lotteryLastPublishedAt: expect.anything(),
          lotteryLastRunAt: expect.anything(),
          lotteryOptIn: true,
          lotteryStatus: LotteryStatusEnum.ran,
          managementCompany: 'example managementCompany',
          managementWebsite: 'example managementWebsite',
          marketingFlyer: 'example marketingFlyer',
          marketingMonth: MonthEnum.january,
          marketingSeason: MarketingSeasonEnum.spring,
          marketingType: MarketingTypeEnum.marketing,
          marketingYear: 2026,
          name: 'example name',
          neighborhood: 'example neighborhood',
          ownerCompany: 'example ownerCompany',
          paperApplication: true,
          parkingFee: 'example parkingFee',
          petPolicy: 'example petPolicy',
          phoneNumber: 'example phoneNumber',
          postmarkedApplicationsReceivedByDate: expect.anything(),
          programRules: 'example programRules',
          publishedAt: expect.anything(),
          referralOpportunity: true,
          region: RegionEnum.Greater_Downtown,
          rentalAssistance: 'example rentalAssistance',
          rentalHistory: 'example rentalHistory',
          requestedChanges: 'example requestedChanges',
          requestedChangesDate: expect.anything(),
          requiredDocuments: 'example requiredDocuments',
          reservedCommunityDescription: 'example reservedCommunityDescription',
          reservedCommunityMinAge: 50,
          resultLink: 'example resultLink',
          reviewOrderType: ReviewOrderTypeEnum.lottery,
          section8Acceptance: true,
          servicesOffered: 'example servicesOffered',
          smokingPolicy: 'example smokingPolicy',
          specialNotes: 'example specialNotes',
          status: ListingsStatusEnum.active,
          temporaryListingId: 58,
          unitAmenities: 'example unitAmenities',
          unitsAvailable: 60,
          verifiedAt: expect.anything(),
          waitlistCurrentSize: 1,
          waitlistMaxSize: 2,
          waitlistOpenSpots: 3,
          wasCreatedExternally: true,
          whatToExpect: 'example whatToExpect',
          whatToExpectAdditionalText: 'example whatToExpectAdditionalText',
          yearBuilt: 2026,
        },
      });
    });
    it('should create snapshot for listing with full ancilliary data', async () => {
      const id = randomUUID();
      const createdAt = new Date();
      const updatedAt = new Date();

      prisma.listings.findUnique = jest.fn().mockResolvedValue({
        id,
        createdAt,
        updatedAt,

        accessibility: 'example accessibility',
        accessibleMarketingFlyer: 'example accessibleMarketingFlyer',
        additionalApplicationSubmissionNotes:
          'example additionalApplicationSubmissionNotes',
        allowsCats: true,
        allowsDogs: true,
        amenities: 'example amenities',
        amiPercentageMax: 1,
        amiPercentageMin: 2,
        applicationDropOffAddressOfficeHours:
          'example applicationDropOffAddressOfficeHours',
        applicationDropOffAddressType: ApplicationAddressTypeEnum.leasingAgent,
        applicationDueDate: new Date(),
        applicationFee: 'example applicationFee',
        applicationMailingAddressType: ApplicationAddressTypeEnum.leasingAgent,
        applicationOpenDate: new Date(),
        applicationOrganization: 'example applicationOrganization',
        applicationPickUpAddressOfficeHours:
          'example applicationPickUpAddressOfficeHours',
        applicationPickUpAddressType: ApplicationAddressTypeEnum.leasingAgent,
        assets: '[]',
        buildingSelectionCriteria: 'example buildingSelectionCriteria',
        buildingTotalUnits: 10,
        closedAt: new Date(),
        cocInfo: 'example cocInfo',
        commonDigitalApplication: true,
        communityDisclaimerDescription:
          'example communityDisclaimerDescription',
        communityDisclaimerTitle: 'example communityDisclaimerTitle',
        configurableRegion: 'example configurableRegion',
        contentUpdatedAt: new Date(),
        costsNotIncluded: 'example costsNotIncluded',
        creditHistory: 'example creditHistory',
        creditScreeningFee: 'example creditScreeningFee',
        criminalBackground: 'example criminalBackground',
        customMapPin: true,
        depositHelperText: 'example depositHelperText',
        depositMax: 'example depositMax',
        depositMin: 'example depositMin',
        depositType: DepositTypeEnum.fixedDeposit,
        depositValue: 10.01,
        developer: 'example developer',
        digitalApplication: true,
        disableUnitsAccordion: true,
        displayWaitlistSize: true,
        hasHudEbllClearance: true,
        homeType: HomeTypeEnum.apartment,
        householdSizeMax: 5,
        householdSizeMin: 1,
        hrdId: 'example hrdId',
        includeCommunityDisclaimer: true,
        isVerified: true,
        isWaitlistOpen: true,
        leasingAgentEmail: 'example leasingAgentEmail',
        leasingAgentName: 'example leasingAgentName',
        leasingAgentOfficeHours: 'example leasingAgentOfficeHours',
        leasingAgentPhone: 'example leasingAgentPhone',
        leasingAgentTitle: 'example leasingAgentTitle',
        listingFileNumber: 'example listingFileNumber',
        listingType: ListingTypeEnum.regulated,
        lotteryLastPublishedAt: new Date(),
        lotteryLastRunAt: new Date(),
        lotteryOptIn: true,
        lotteryStatus: LotteryStatusEnum.ran,
        managementCompany: 'example managementCompany',
        managementWebsite: 'example managementWebsite',
        marketingFlyer: 'example marketingFlyer',
        marketingMonth: MonthEnum.january,
        marketingSeason: MarketingSeasonEnum.spring,
        marketingType: MarketingTypeEnum.marketing,
        marketingYear: 2026,
        name: 'example name',
        neighborhood: 'example neighborhood',
        ownerCompany: 'example ownerCompany',
        paperApplication: true,
        parkingFee: 'example parkingFee',
        petPolicy: 'example petPolicy',
        phoneNumber: 'example phoneNumber',
        postmarkedApplicationsReceivedByDate: new Date(),
        programRules: 'example programRules',
        publishedAt: new Date(),
        referralOpportunity: true,
        region: RegionEnum.Greater_Downtown,
        rentalAssistance: 'example rentalAssistance',
        rentalHistory: 'example rentalHistory',
        requestedChanges: 'example requestedChanges',
        requestedChangesDate: new Date(),
        requiredDocuments: 'example requiredDocuments',
        reservedCommunityDescription: 'example reservedCommunityDescription',
        reservedCommunityMinAge: 50,
        resultLink: 'example resultLink',
        reviewOrderType: ReviewOrderTypeEnum.lottery,
        section8Acceptance: true,
        servicesOffered: 'example servicesOffered',
        smokingPolicy: 'example smokingPolicy',
        specialNotes: 'example specialNotes',
        status: ListingsStatusEnum.active,
        temporaryListingId: 58,
        unitAmenities: 'example unitAmenities',
        unitsAvailable: 60,
        verifiedAt: new Date(),
        waitlistCurrentSize: 1,
        waitlistMaxSize: 2,
        waitlistOpenSpots: 3,
        wasCreatedExternally: true,
        whatToExpect: 'example whatToExpect',
        whatToExpectAdditionalText: 'example whatToExpectAdditionalText',
        yearBuilt: 2026,

        applicationMethods: [
          {
            id: 'example application method id 1',
            createdAt: new Date(),
            updatedAt: new Date(),
            acceptsPostmarkedApplications: true,
            externalReference: 'example externalReference',
            label: 'example label',
            phoneNumber: 'example phoneNumber',
            type: ApplicationMethodsTypeEnum.ExternalLink,
            paperApplications: [
              {
                id: 'example paper app id 1',
                createdAt: new Date(),
                updatedAt: new Date(),
                language: LanguagesEnum.ko,
                assets: {
                  id: 'example paper app asset id',
                  createdAt: new Date(),
                  updatedAt: new Date(),
                  fileId: 'example fileId',
                  label: 'example label',
                },
              },
              {
                id: 'example paper app id 2',
                createdAt: new Date(),
                updatedAt: new Date(),
                language: LanguagesEnum.ko,
                assets: {
                  id: 'example paper app asset id',
                  createdAt: new Date(),
                  updatedAt: new Date(),
                  fileId: 'example fileId',
                  label: 'example label',
                },
              },
            ],
          },
          {
            id: 'example application method id 2',
            createdAt: new Date(),
            updatedAt: new Date(),
            acceptsPostmarkedApplications: true,
            externalReference: 'example externalReference',
            label: 'example label',
            phoneNumber: 'example phoneNumber',
            type: ApplicationMethodsTypeEnum.ExternalLink,
            paperApplications: [
              {
                id: 'example paper app id 1',
                createdAt: new Date(),
                updatedAt: new Date(),
                language: LanguagesEnum.ko,
                assets: {
                  id: 'example paper app asset id',
                  createdAt: new Date(),
                  updatedAt: new Date(),
                  fileId: 'example fileId',
                  label: 'example label',
                },
              },
              {
                id: 'example paper app id 2',
                createdAt: new Date(),
                updatedAt: new Date(),
                language: LanguagesEnum.ko,
                assets: {
                  id: 'example paper app asset id',
                  createdAt: new Date(),
                  updatedAt: new Date(),
                  fileId: 'example fileId',
                  label: 'example label',
                },
              },
            ],
          },
        ],
        jurisdictions: {
          id: 'example jurisdiction id',
        },
        reservedCommunityTypes: {
          id: 'example community type id',
        },
        listingFeatures: {
          id: 'example listingFeatures id',
          createdAt: new Date(),
          updatedAt: new Date(),
          accessibleHeightToilet: true,
          accessibleParking: true,
          acInUnit: true,
          barrierFreeBathroom: true,
          barrierFreeEntrance: true,
          barrierFreePropertyEntrance: true,
          barrierFreeUnitEntrance: true,
          bathGrabBarsOrReinforcements: true,
          bathroomCounterLowered: true,
          brailleSignageInBuilding: true,
          carbonMonoxideDetectorWithStrobe: true,
          carpetInUnit: true,
          elevator: true,
          extraAudibleCarbonMonoxideDetector: true,
          extraAudibleSmokeDetector: true,
          fireSuppressionSprinklerSystem: true,
          frontControlsDishwasher: true,
          frontControlsStoveCookTop: true,
          grabBars: true,
          hardFlooringInUnit: true,
          hearing: true,
          hearingAndVision: true,
          heatingInUnit: true,
          inUnitWasherDryer: true,
          kitchenCounterLowered: true,
          laundryInBuilding: true,
          leverHandlesOnDoors: true,
          leverHandlesOnFaucets: true,
          loweredCabinets: true,
          loweredLightSwitch: true,
          mobility: true,
          noEntryStairs: true,
          nonDigitalKitchenAppliances: true,
          noStairsToParkingSpots: true,
          noStairsWithinUnit: true,
          parkingOnSite: true,
          refrigeratorWithBottomDoorFreezer: true,
          rollInShower: true,
          serviceAnimalsAllowed: true,
          smokeDetectorWithStrobe: true,
          streetLevelEntrance: true,
          toiletGrabBarsOrReinforcements: true,
          ttyAmplifiedPhone: true,
          turningCircleInBathrooms: true,
          visual: true,
          walkInShower: true,
          wheelchairRamp: true,
          wideDoorways: true,
        },
        listingNeighborhoodAmenities: {
          id: 'example listing neighborhood amenities id',
          createdAt: new Date(),
          updatedAt: new Date(),
          busStops: 'example busStops',
          groceryStores: 'example groceryStores',
          healthCareResources: 'example healthCareResources',
          hospitals: 'example hospitals',
          parksAndCommunityCenters: 'example parksAndCommunityCenters',
          pharmacies: 'example pharmacies',
          playgrounds: 'example playgrounds',
          publicTransportation: 'example publicTransportation',
          recreationalFacilities: 'example recreationalFacilities',
          schools: 'example schools',
          seniorCenters: 'example seniorCenters',
          shoppingVenues: 'example shoppingVenues',
        },
        listingsApplicationDropOffAddress: {
          id: 'example drop off address id',
          createdAt: new Date(),
          updatedAt: new Date(),
          city: 'example city',
          county: 'example county',
          latitude: 1.025,
          longitude: 1.025,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        listingsApplicationMailingAddress: {
          id: 'example mailing address id',
          createdAt: new Date(),
          updatedAt: new Date(),
          city: 'example city',
          county: 'example county',
          latitude: 1.025,
          longitude: 1.025,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        listingsApplicationPickUpAddress: {
          id: 'example pickup address id',
          createdAt: new Date(),
          updatedAt: new Date(),
          city: 'example city',
          county: 'example county',
          latitude: 1.025,
          longitude: 1.025,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        listingsBuildingAddress: {
          id: 'example building address id',
          createdAt: new Date(),
          updatedAt: new Date(),
          city: 'example city',
          county: 'example county',
          latitude: 1.025,
          longitude: 1.025,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        listingsLeasingAgentAddress: {
          id: 'example leasing agent address id',
          createdAt: new Date(),
          updatedAt: new Date(),
          city: 'example city',
          county: 'example county',
          latitude: 1.025,
          longitude: 1.025,
          placeName: 'example placeName',
          state: 'example state',
          street: 'example street',
          street2: 'example street2',
          zipCode: 'example zipCode',
        },
        listingsAccessibleMarketingFlyerFile: {
          id: 'example accessibile marketing flyer file id',
          createdAt: new Date(),
          updatedAt: new Date(),
          fileId: 'example fileId',
          label: 'example label',
        },
        listingsBuildingSelectionCriteriaFile: {
          id: 'example selection criteria id',
          createdAt: new Date(),
          updatedAt: new Date(),
          fileId: 'example fileId',
          label: 'example label',
        },
        listingsMarketingFlyerFile: {
          id: 'example flyer id',
          createdAt: new Date(),
          updatedAt: new Date(),
          fileId: 'example fileId',
          label: 'example label',
        },
        listingsResult: {
          id: 'example result id',
          createdAt: new Date(),
          updatedAt: new Date(),
          fileId: 'example fileId',
          label: 'example label',
        },
        listingMultiselectQuestions: [
          {
            multiselectQuestionId: 'example multiselectQuestionId 1',
            ordinal: 18,
          },
          {
            multiselectQuestionId: 'example multiselectQuestionId 2',
            ordinal: 19,
          },
        ],
        listingUtilities: {
          id: 'example utilities id',
          createdAt: new Date(),
          updatedAt: new Date(),
          cable: true,
          electricity: true,
          gas: true,
          internet: true,
          phone: true,
          sewer: true,
          trash: true,
          water: true,
        },
        listingImages: [
          {
            assets: {
              id: 'example image id',
              createdAt: new Date(),
              updatedAt: new Date(),
              fileId: 'example fileId',
              label: 'example label',
            },
            description: 'example description 1',
            ordinal: 48,
          },
          {
            assets: {
              id: 'example image id',
              createdAt: new Date(),
              updatedAt: new Date(),
              fileId: 'example fileId',
              label: 'example label',
            },
            description: 'example description 2',
            ordinal: 1,
          },
        ],
        listingEvents: [
          {
            id: 'example event id 1',
            createdAt: new Date(),
            updatedAt: new Date(),
            endTime: new Date(),
            label: 'example label',
            note: 'example note',
            startDate: new Date(),
            startTime: new Date(),
            type: ListingEventsTypeEnum.openHouse,
            url: 'example url',
            assets: {
              id: 'example event asset id',
              createdAt: new Date(),
              updatedAt: new Date(),
              fileId: 'example fileId',
              label: 'example label',
            },
          },
          {
            id: 'example event id 2',
            createdAt: new Date(),
            updatedAt: new Date(),
            endTime: new Date(),
            label: 'example label',
            note: 'example note',
            startDate: new Date(),
            startTime: new Date(),
            type: ListingEventsTypeEnum.openHouse,
            url: 'example url',
            assets: {
              id: 'example event asset id',
              createdAt: new Date(),
              updatedAt: new Date(),
              fileId: 'example fileId',
              label: 'example label',
            },
          },
        ],
        property: {
          id: 'example property id',
        },
        requiredDocumentsList: {
          id: 'example required documents id',
          createdAt: new Date(),
          updatedAt: new Date(),
          birthCertificate: true,
          currentLandlordReference: true,
          governmentIssuedId: true,
          previousLandlordReference: true,
          proofOfAssets: true,
          proofOfCustody: true,
          proofOfIncome: true,
          residencyDocuments: true,
          socialSecurityCard: true,
        },
        unitGroups: [
          {
            id: 'example unit group id 1',
            createdAt: new Date(),
            updatedAt: new Date(),
            bathroomMax: 10.874,
            bathroomMin: 10.874,
            flatRentValueFrom: 10.874,
            flatRentValueTo: 10.874,
            floorMax: 1,
            floorMin: 18,
            maxOccupancy: 9,
            minOccupancy: 12,
            monthlyRent: 1.54,
            openWaitlist: true,
            accessibilityPriorityType:
              UnitAccessibilityPriorityTypeEnum.mobilityAndHearing,
            rentType: RentTypeEnum.fixedRent,
            sqFeetMax: 874.01,
            sqFeetMin: 984.25,
            totalAvailable: 12,
            totalCount: 15,
            unitGroupAmiLevels: [
              {
                id: 'example unit group ami level id',
                createdAt: new Date(),
                updatedAt: new Date(),
                amiPercentage: 80,
                flatRentValue: 65.01,
                monthlyRentDeterminationType:
                  MonthlyRentDeterminationTypeEnum.percentageOfIncome,
                percentageOfIncomeValue: 78.4,
                amiChart: {
                  id: 'example ami chart id',
                },
              },
            ],
            unitTypes: [
              {
                id: 'example unit type id 1',
              },
              {
                id: 'example unit type id 2',
              },
            ],
          },
          {
            id: 'example unit group id 2',
            createdAt: new Date(),
            updatedAt: new Date(),
            bathroomMax: 10.874,
            bathroomMin: 10.874,
            flatRentValueFrom: 10.874,
            flatRentValueTo: 10.874,
            floorMax: 1,
            floorMin: 18,
            maxOccupancy: 9,
            minOccupancy: 12,
            monthlyRent: 1.54,
            openWaitlist: true,
            accessibilityPriorityType:
              UnitAccessibilityPriorityTypeEnum.mobilityAndHearing,
            rentType: RentTypeEnum.fixedRent,
            sqFeetMax: 874.01,
            sqFeetMin: 984.25,
            totalAvailable: 12,
            totalCount: 15,
            unitGroupAmiLevels: [
              {
                id: 'example unit group ami level id',
                createdAt: new Date(),
                updatedAt: new Date(),
                amiPercentage: 80,
                flatRentValue: 65.01,
                monthlyRentDeterminationType:
                  MonthlyRentDeterminationTypeEnum.percentageOfIncome,
                percentageOfIncomeValue: 78.4,
                amiChart: {
                  id: 'example ami chart id',
                },
              },
            ],
            unitTypes: [
              {
                id: 'example unit type id 1',
              },
              {
                id: 'example unit type id 2',
              },
            ],
          },
        ],
        units: [
          {
            id: 'example unit id',
            createdAt: new Date(),
            updatedAt: new Date(),
            amiPercentage: 'example amiPercentage',
            annualIncomeMax: 'example annualIncomeMax',
            annualIncomeMin: 'example annualIncomeMin',
            bmrProgramChart: true,
            floor: 2,
            maxOccupancy: 3,
            minOccupancy: 4,
            monthlyIncomeMin: 5,
            monthlyRent: 6,
            monthlyRentAsPercentOfIncome: 7.05,
            numBathrooms: 8,
            numBedrooms: 9,
            number: 'example number',
            accessibilityPriorityType: UnitAccessibilityPriorityTypeEnum.vision,
            sqFeet: 45.48,
            status: UnitsStatusEnum.unknown,
            amiChart: {
              id: 'example ami chart id',
            },
            unitAmiChartOverrides: {
              id: 'example override id',
              createdAt: new Date(),
              updatedAt: new Date(),
              items: '[]',
            },
            unitRentTypes: {
              id: 'example rent type id',
            },
            unitTypes: {
              id: 'example unit type id',
            },
          },
        ],
      });
      prisma.listingSnapshot.create = jest.fn().mockResolvedValue({ id });

      await service.createListingSnapshot(id);

      expect(prisma.listings.findUnique).toHaveBeenCalledWith({
        where: {
          id,
        },
        select: {
          id: true,
          createdAt: true,
          updatedAt: true,
          accessibility: true,
          accessibleMarketingFlyer: true,
          additionalApplicationSubmissionNotes: true,
          allowsCats: true,
          allowsDogs: true,
          amenities: true,
          amiPercentageMax: true,
          amiPercentageMin: true,
          applicationDropOffAddressOfficeHours: true,
          applicationDropOffAddressType: true,
          applicationDueDate: true,
          applicationFee: true,
          applicationMailingAddressType: true,
          applicationOpenDate: true,
          applicationOrganization: true,
          applicationPickUpAddressOfficeHours: true,
          applicationPickUpAddressType: true,
          assets: true,
          buildingSelectionCriteria: true,
          buildingTotalUnits: true,
          closedAt: true,
          cocInfo: true,
          commonDigitalApplication: true,
          communityDisclaimerDescription: true,
          communityDisclaimerTitle: true,
          configurableRegion: true,
          contentUpdatedAt: true,
          costsNotIncluded: true,
          creditHistory: true,
          creditScreeningFee: true,
          criminalBackground: true,
          customMapPin: true,
          depositHelperText: true,
          depositMax: true,
          depositMin: true,
          depositType: true,
          depositValue: true,
          developer: true,
          digitalApplication: true,
          disableUnitsAccordion: true,
          displayWaitlistSize: true,
          hasHudEbllClearance: true,
          homeType: true,
          householdSizeMax: true,
          householdSizeMin: true,
          hrdId: true,
          includeCommunityDisclaimer: true,
          isVerified: true,
          isWaitlistOpen: true,
          leasingAgentEmail: true,
          leasingAgentName: true,
          leasingAgentOfficeHours: true,
          leasingAgentPhone: true,
          leasingAgentTitle: true,
          listingFileNumber: true,
          listingType: true,
          lotteryLastPublishedAt: true,
          lotteryLastRunAt: true,
          lotteryOptIn: true,
          lotteryStatus: true,
          managementCompany: true,
          managementWebsite: true,
          marketingFlyer: true,
          marketingMonth: true,
          marketingSeason: true,
          marketingType: true,
          marketingYear: true,
          name: true,
          neighborhood: true,
          ownerCompany: true,
          paperApplication: true,
          parkingFee: true,
          petPolicy: true,
          phoneNumber: true,
          postmarkedApplicationsReceivedByDate: true,
          programRules: true,
          publishedAt: true,
          referralOpportunity: true,
          region: true,
          rentalAssistance: true,
          rentalHistory: true,
          requestedChanges: true,
          requestedChangesDate: true,
          requiredDocuments: true,
          reservedCommunityDescription: true,
          reservedCommunityMinAge: true,
          resultLink: true,
          reviewOrderType: true,
          section8Acceptance: true,
          servicesOffered: true,
          smokingPolicy: true,
          specialNotes: true,
          status: true,
          temporaryListingId: true,
          unitAmenities: true,
          unitsAvailable: true,
          verifiedAt: true,
          waitlistCurrentSize: true,
          waitlistMaxSize: true,
          waitlistOpenSpots: true,
          wasCreatedExternally: true,
          whatToExpect: true,
          whatToExpectAdditionalText: true,
          yearBuilt: true,

          applicationMethods: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              acceptsPostmarkedApplications: true,
              externalReference: true,
              label: true,
              phoneNumber: true,
              type: true,
              paperApplications: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  language: true,
                  assets: {
                    select: {
                      id: true,
                      createdAt: true,
                      updatedAt: true,
                      fileId: true,
                      label: true,
                    },
                  },
                },
              },
            },
          },
          jurisdictions: {
            select: {
              id: true,
            },
          },
          reservedCommunityTypes: {
            select: {
              id: true,
            },
          },
          listingFeatures: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              accessibleHeightToilet: true,
              accessibleParking: true,
              acInUnit: true,
              barrierFreeBathroom: true,
              barrierFreeEntrance: true,
              barrierFreePropertyEntrance: true,
              barrierFreeUnitEntrance: true,
              bathGrabBarsOrReinforcements: true,
              bathroomCounterLowered: true,
              brailleSignageInBuilding: true,
              carbonMonoxideDetectorWithStrobe: true,
              carpetInUnit: true,
              elevator: true,
              extraAudibleCarbonMonoxideDetector: true,
              extraAudibleSmokeDetector: true,
              fireSuppressionSprinklerSystem: true,
              frontControlsDishwasher: true,
              frontControlsStoveCookTop: true,
              grabBars: true,
              hardFlooringInUnit: true,
              hearing: true,
              hearingAndVision: true,
              heatingInUnit: true,
              inUnitWasherDryer: true,
              kitchenCounterLowered: true,
              laundryInBuilding: true,
              leverHandlesOnDoors: true,
              leverHandlesOnFaucets: true,
              loweredCabinets: true,
              loweredLightSwitch: true,
              mobility: true,
              noEntryStairs: true,
              nonDigitalKitchenAppliances: true,
              noStairsToParkingSpots: true,
              noStairsWithinUnit: true,
              parkingOnSite: true,
              refrigeratorWithBottomDoorFreezer: true,
              rollInShower: true,
              serviceAnimalsAllowed: true,
              smokeDetectorWithStrobe: true,
              streetLevelEntrance: true,
              toiletGrabBarsOrReinforcements: true,
              ttyAmplifiedPhone: true,
              turningCircleInBathrooms: true,
              visual: true,
              walkInShower: true,
              wheelchairRamp: true,
              wideDoorways: true,
            },
          },
          listingNeighborhoodAmenities: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              busStops: true,
              groceryStores: true,
              healthCareResources: true,
              hospitals: true,
              parksAndCommunityCenters: true,
              pharmacies: true,
              playgrounds: true,
              publicTransportation: true,
              recreationalFacilities: true,
              schools: true,
              seniorCenters: true,
              shoppingVenues: true,
            },
          },
          listingsApplicationDropOffAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsApplicationMailingAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsApplicationPickUpAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsBuildingAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsLeasingAgentAddress: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              city: true,
              county: true,
              latitude: true,
              longitude: true,
              placeName: true,
              state: true,
              street: true,
              street2: true,
              zipCode: true,
            },
          },
          listingsAccessibleMarketingFlyerFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsBuildingSelectionCriteriaFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsMarketingFlyerFile: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingsResult: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              fileId: true,
              label: true,
            },
          },
          listingMultiselectQuestions: {
            select: {
              multiselectQuestionId: true,
              ordinal: true,
            },
          },
          listingUtilities: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              cable: true,
              electricity: true,
              gas: true,
              internet: true,
              phone: true,
              sewer: true,
              trash: true,
              water: true,
            },
          },
          listingImages: {
            select: {
              assets: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  fileId: true,
                  label: true,
                },
              },
              description: true,
              ordinal: true,
            },
          },
          listingEvents: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              endTime: true,
              label: true,
              note: true,
              startDate: true,
              startTime: true,
              type: true,
              url: true,
              assets: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  fileId: true,
                  label: true,
                },
              },
            },
          },
          property: {
            select: {
              id: true,
            },
          },
          requiredDocumentsList: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              birthCertificate: true,
              currentLandlordReference: true,
              governmentIssuedId: true,
              previousLandlordReference: true,
              proofOfAssets: true,
              proofOfCustody: true,
              proofOfIncome: true,
              residencyDocuments: true,
              socialSecurityCard: true,
            },
          },
          unitGroups: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              bathroomMax: true,
              bathroomMin: true,
              flatRentValueFrom: true,
              flatRentValueTo: true,
              floorMax: true,
              floorMin: true,
              maxOccupancy: true,
              minOccupancy: true,
              monthlyRent: true,
              openWaitlist: true,
              accessibilityPriorityType: true,
              rentType: true,
              sqFeetMax: true,
              sqFeetMin: true,
              totalAvailable: true,
              totalCount: true,
              unitGroupAmiLevels: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  amiPercentage: true,
                  flatRentValue: true,
                  monthlyRentDeterminationType: true,
                  percentageOfIncomeValue: true,
                  amiChart: {
                    select: {
                      id: true,
                    },
                  },
                },
              },
              unitTypes: {
                select: {
                  id: true,
                },
              },
            },
          },
          units: {
            select: {
              id: true,
              createdAt: true,
              updatedAt: true,
              amiPercentage: true,
              annualIncomeMax: true,
              annualIncomeMin: true,
              bmrProgramChart: true,
              floor: true,
              maxOccupancy: true,
              minOccupancy: true,
              monthlyIncomeMin: true,
              monthlyRent: true,
              monthlyRentAsPercentOfIncome: true,
              numBathrooms: true,
              numBedrooms: true,
              number: true,
              accessibilityPriorityType: true,
              sqFeet: true,
              status: true,
              amiChart: {
                select: {
                  id: true,
                },
              },
              unitAmiChartOverrides: {
                select: {
                  id: true,
                  createdAt: true,
                  updatedAt: true,
                  items: true,
                },
              },
              unitRentTypes: {
                select: {
                  id: true,
                },
              },
              unitTypes: {
                select: {
                  id: true,
                },
              },
            },
          },
        },
      });
      expect(prisma.listingSnapshot.create).toHaveBeenCalledWith({
        data: {
          originalId: id,
          originalCreatedAt: createdAt,
          updatedAt,

          accessibility: 'example accessibility',
          accessibleMarketingFlyer: 'example accessibleMarketingFlyer',
          additionalApplicationSubmissionNotes:
            'example additionalApplicationSubmissionNotes',
          allowsCats: true,
          allowsDogs: true,
          amenities: 'example amenities',
          amiPercentageMax: 1,
          amiPercentageMin: 2,
          applicationDropOffAddressOfficeHours:
            'example applicationDropOffAddressOfficeHours',
          applicationDropOffAddressType:
            ApplicationAddressTypeEnum.leasingAgent,
          applicationDueDate: expect.anything(),
          applicationFee: 'example applicationFee',
          applicationMailingAddressType:
            ApplicationAddressTypeEnum.leasingAgent,
          applicationOpenDate: expect.anything(),
          applicationOrganization: 'example applicationOrganization',
          applicationPickUpAddressOfficeHours:
            'example applicationPickUpAddressOfficeHours',
          applicationPickUpAddressType: ApplicationAddressTypeEnum.leasingAgent,
          assets: '[]',
          buildingSelectionCriteria: 'example buildingSelectionCriteria',
          buildingTotalUnits: 10,
          closedAt: expect.anything(),
          cocInfo: 'example cocInfo',
          commonDigitalApplication: true,
          communityDisclaimerDescription:
            'example communityDisclaimerDescription',
          communityDisclaimerTitle: 'example communityDisclaimerTitle',
          configurableRegion: 'example configurableRegion',
          contentUpdatedAt: expect.anything(),
          costsNotIncluded: 'example costsNotIncluded',
          creditHistory: 'example creditHistory',
          creditScreeningFee: 'example creditScreeningFee',
          criminalBackground: 'example criminalBackground',
          customMapPin: true,
          depositHelperText: 'example depositHelperText',
          depositMax: 'example depositMax',
          depositMin: 'example depositMin',
          depositType: DepositTypeEnum.fixedDeposit,
          depositValue: 10.01,
          developer: 'example developer',
          digitalApplication: true,
          disableUnitsAccordion: true,
          displayWaitlistSize: true,
          hasHudEbllClearance: true,
          homeType: HomeTypeEnum.apartment,
          householdSizeMax: 5,
          householdSizeMin: 1,
          hrdId: 'example hrdId',
          includeCommunityDisclaimer: true,
          isVerified: true,
          isWaitlistOpen: true,
          leasingAgentEmail: 'example leasingAgentEmail',
          leasingAgentName: 'example leasingAgentName',
          leasingAgentOfficeHours: 'example leasingAgentOfficeHours',
          leasingAgentPhone: 'example leasingAgentPhone',
          leasingAgentTitle: 'example leasingAgentTitle',
          listingFileNumber: 'example listingFileNumber',
          listingType: ListingTypeEnum.regulated,
          lotteryLastPublishedAt: expect.anything(),
          lotteryLastRunAt: expect.anything(),
          lotteryOptIn: true,
          lotteryStatus: LotteryStatusEnum.ran,
          managementCompany: 'example managementCompany',
          managementWebsite: 'example managementWebsite',
          marketingFlyer: 'example marketingFlyer',
          marketingMonth: MonthEnum.january,
          marketingSeason: MarketingSeasonEnum.spring,
          marketingType: MarketingTypeEnum.marketing,
          marketingYear: 2026,
          name: 'example name',
          neighborhood: 'example neighborhood',
          ownerCompany: 'example ownerCompany',
          paperApplication: true,
          parkingFee: 'example parkingFee',
          petPolicy: 'example petPolicy',
          phoneNumber: 'example phoneNumber',
          postmarkedApplicationsReceivedByDate: expect.anything(),
          programRules: 'example programRules',
          publishedAt: expect.anything(),
          referralOpportunity: true,
          region: RegionEnum.Greater_Downtown,
          rentalAssistance: 'example rentalAssistance',
          rentalHistory: 'example rentalHistory',
          requestedChanges: 'example requestedChanges',
          requestedChangesDate: expect.anything(),
          requiredDocuments: 'example requiredDocuments',
          reservedCommunityDescription: 'example reservedCommunityDescription',
          reservedCommunityMinAge: 50,
          resultLink: 'example resultLink',
          reviewOrderType: ReviewOrderTypeEnum.lottery,
          section8Acceptance: true,
          servicesOffered: 'example servicesOffered',
          smokingPolicy: 'example smokingPolicy',
          specialNotes: 'example specialNotes',
          status: ListingsStatusEnum.active,
          temporaryListingId: 58,
          unitAmenities: 'example unitAmenities',
          unitsAvailable: 60,
          verifiedAt: expect.anything(),
          waitlistCurrentSize: 1,
          waitlistMaxSize: 2,
          waitlistOpenSpots: 3,
          wasCreatedExternally: true,
          whatToExpect: 'example whatToExpect',
          whatToExpectAdditionalText: 'example whatToExpectAdditionalText',
          yearBuilt: 2026,

          jurisdiction: {
            connect: {
              id: 'example jurisdiction id',
            },
          },
          property: {
            connect: {
              id: 'example property id',
            },
          },
          reservedCommunityType: {
            connect: {
              id: 'example community type id',
            },
          },
          applicationMethod: {
            create: [
              {
                acceptsPostmarkedApplications: true,
                createdAt: undefined,
                externalReference: 'example externalReference',
                id: undefined,
                label: 'example label',
                originalCreatedAt: expect.anything(),
                originalId: 'example application method id 1',
                paperApplication: {
                  create: [
                    {
                      asset: {
                        create: {
                          fileId: 'example fileId',
                          label: 'example label',
                          originalCreatedAt: expect.anything(),
                          originalId: 'example paper app asset id',
                          updatedAt: expect.anything(),
                        },
                      },
                      createdAt: undefined,
                      id: undefined,
                      language: 'ko',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example paper app id 1',
                      updatedAt: expect.anything(),
                    },
                    {
                      asset: {
                        create: {
                          fileId: 'example fileId',
                          label: 'example label',
                          originalCreatedAt: expect.anything(),
                          originalId: 'example paper app asset id',
                          updatedAt: expect.anything(),
                        },
                      },
                      createdAt: undefined,
                      id: undefined,
                      language: 'ko',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example paper app id 2',
                      updatedAt: expect.anything(),
                    },
                  ],
                },
                phoneNumber: 'example phoneNumber',
                type: 'ExternalLink',
                updatedAt: expect.anything(),
              },
              {
                acceptsPostmarkedApplications: true,
                createdAt: undefined,
                externalReference: 'example externalReference',
                id: undefined,
                label: 'example label',
                originalCreatedAt: expect.anything(),
                originalId: 'example application method id 2',
                paperApplication: {
                  create: [
                    {
                      asset: {
                        create: {
                          fileId: 'example fileId',
                          label: 'example label',
                          originalCreatedAt: expect.anything(),
                          originalId: 'example paper app asset id',
                          updatedAt: expect.anything(),
                        },
                      },
                      createdAt: undefined,
                      id: undefined,
                      language: 'ko',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example paper app id 1',
                      updatedAt: expect.anything(),
                    },
                    {
                      asset: {
                        create: {
                          fileId: 'example fileId',
                          label: 'example label',
                          originalCreatedAt: expect.anything(),
                          originalId: 'example paper app asset id',
                          updatedAt: expect.anything(),
                        },
                      },
                      createdAt: undefined,
                      id: undefined,
                      language: 'ko',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example paper app id 2',
                      updatedAt: expect.anything(),
                    },
                  ],
                },
                phoneNumber: 'example phoneNumber',
                type: 'ExternalLink',
                updatedAt: expect.anything(),
              },
            ],
          },
          listingEvent: {
            create: [
              {
                asset: {
                  create: {
                    createdAt: undefined,
                    fileId: 'example fileId',
                    id: undefined,
                    label: 'example label',
                    originalCreatedAt: expect.anything(),
                    originalId: 'example event asset id',
                    updatedAt: expect.anything(),
                  },
                },
                createdAt: undefined,
                endTime: expect.anything(),
                id: undefined,
                label: 'example label',
                note: 'example note',
                originalCreatedAt: expect.anything(),
                originalId: 'example event id 1',
                startDate: expect.anything(),
                startTime: expect.anything(),
                type: 'openHouse',
                updatedAt: expect.anything(),
                url: 'example url',
              },
              {
                asset: {
                  create: {
                    createdAt: undefined,
                    fileId: 'example fileId',
                    id: undefined,
                    label: 'example label',
                    originalCreatedAt: expect.anything(),
                    originalId: 'example event asset id',
                    updatedAt: expect.anything(),
                  },
                },
                createdAt: undefined,
                endTime: expect.anything(),
                id: undefined,
                label: 'example label',
                note: 'example note',
                originalCreatedAt: expect.anything(),
                originalId: 'example event id 2',
                startDate: expect.anything(),
                startTime: expect.anything(),
                type: 'openHouse',
                updatedAt: expect.anything(),
                url: 'example url',
              },
            ],
          },
          listingFeature: {
            create: {
              acInUnit: true,
              accessibleHeightToilet: true,
              accessibleParking: true,
              barrierFreeBathroom: true,
              barrierFreeEntrance: true,
              barrierFreePropertyEntrance: true,
              barrierFreeUnitEntrance: true,
              bathGrabBarsOrReinforcements: true,
              bathroomCounterLowered: true,
              brailleSignageInBuilding: true,
              carbonMonoxideDetectorWithStrobe: true,
              carpetInUnit: true,
              createdAt: undefined,
              elevator: true,
              extraAudibleCarbonMonoxideDetector: true,
              extraAudibleSmokeDetector: true,
              fireSuppressionSprinklerSystem: true,
              frontControlsDishwasher: true,
              frontControlsStoveCookTop: true,
              grabBars: true,
              hardFlooringInUnit: true,
              hearing: true,
              hearingAndVision: true,
              heatingInUnit: true,
              id: undefined,
              inUnitWasherDryer: true,
              kitchenCounterLowered: true,
              laundryInBuilding: true,
              leverHandlesOnDoors: true,
              leverHandlesOnFaucets: true,
              loweredCabinets: true,
              loweredLightSwitch: true,
              mobility: true,
              noEntryStairs: true,
              noStairsToParkingSpots: true,
              noStairsWithinUnit: true,
              nonDigitalKitchenAppliances: true,
              originalCreatedAt: expect.anything(),
              originalId: 'example listingFeatures id',
              parkingOnSite: true,
              refrigeratorWithBottomDoorFreezer: true,
              rollInShower: true,
              serviceAnimalsAllowed: true,
              smokeDetectorWithStrobe: true,
              streetLevelEntrance: true,
              toiletGrabBarsOrReinforcements: true,
              ttyAmplifiedPhone: true,
              turningCircleInBathrooms: true,
              updatedAt: expect.anything(),
              visual: true,
              walkInShower: true,
              wheelchairRamp: true,
              wideDoorways: true,
            },
          },
          listingImage: {
            create: [
              {
                asset: {
                  create: {
                    fileId: 'example fileId',
                    label: 'example label',
                    originalCreatedAt: expect.anything(),
                    originalId: 'example image id',
                    updatedAt: expect.anything(),
                  },
                },
                description: 'example description 1',
                ordinal: 48,
              },
              {
                asset: {
                  create: {
                    fileId: 'example fileId',
                    label: 'example label',
                    originalCreatedAt: expect.anything(),
                    originalId: 'example image id',
                    updatedAt: expect.anything(),
                  },
                },
                description: 'example description 2',
                ordinal: 1,
              },
            ],
          },
          listingMultiselectQuestion: {
            create: [
              {
                multiselectQuestion: {
                  connect: {
                    id: 'example multiselectQuestionId 1',
                  },
                },
                ordinal: 18,
              },
              {
                multiselectQuestion: {
                  connect: {
                    id: 'example multiselectQuestionId 2',
                  },
                },
                ordinal: 19,
              },
            ],
          },
          listingNeighborhoodAmenity: {
            create: {
              busStops: 'example busStops',
              createdAt: undefined,
              groceryStores: 'example groceryStores',
              healthCareResources: 'example healthCareResources',
              hospitals: 'example hospitals',
              id: undefined,
              originalCreatedAt: expect.anything(),
              originalId: 'example listing neighborhood amenities id',
              parksAndCommunityCenters: 'example parksAndCommunityCenters',
              pharmacies: 'example pharmacies',
              playgrounds: 'example playgrounds',
              publicTransportation: 'example publicTransportation',
              recreationalFacilities: 'example recreationalFacilities',
              schools: 'example schools',
              seniorCenters: 'example seniorCenters',
              shoppingVenues: 'example shoppingVenues',
              updatedAt: expect.anything(),
            },
          },
          listingUtility: {
            create: {
              cable: true,
              createdAt: undefined,
              electricity: true,
              gas: true,
              id: undefined,
              internet: true,
              originalCreatedAt: expect.anything(),
              originalId: 'example utilities id',
              phone: true,
              sewer: true,
              trash: true,
              updatedAt: expect.anything(),
              water: true,
            },
          },
          listingsAccessibleMarketingFlyerFile: {
            create: {
              createdAt: undefined,
              fileId: 'example fileId',
              id: undefined,
              label: 'example label',
              originalCreatedAt: expect.anything(),
              originalId: 'example accessibile marketing flyer file id',
              updatedAt: expect.anything(),
            },
          },
          listingsApplicationDropOffAddress: {
            create: {
              city: 'example city',
              county: 'example county',
              createdAt: undefined,
              id: undefined,
              latitude: 1.025,
              longitude: 1.025,
              originalCreatedAt: expect.anything(),
              originalId: 'example drop off address id',
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              updatedAt: expect.anything(),
              zipCode: 'example zipCode',
            },
          },
          listingsApplicationMailingAddress: {
            create: {
              city: 'example city',
              county: 'example county',
              createdAt: undefined,
              id: undefined,
              latitude: 1.025,
              longitude: 1.025,
              originalCreatedAt: expect.anything(),
              originalId: 'example mailing address id',
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              updatedAt: expect.anything(),
              zipCode: 'example zipCode',
            },
          },
          listingsApplicationPickUpAddress: {
            create: {
              city: 'example city',
              county: 'example county',
              createdAt: undefined,
              id: undefined,
              latitude: 1.025,
              longitude: 1.025,
              originalCreatedAt: expect.anything(),
              originalId: 'example pickup address id',
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              updatedAt: expect.anything(),
              zipCode: 'example zipCode',
            },
          },
          listingsBuildingAddress: {
            create: {
              city: 'example city',
              county: 'example county',
              createdAt: undefined,
              id: undefined,
              latitude: 1.025,
              longitude: 1.025,
              originalCreatedAt: expect.anything(),
              originalId: 'example building address id',
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              updatedAt: expect.anything(),
              zipCode: 'example zipCode',
            },
          },
          listingsBuildingSelectionCriteriaFile: {
            create: {
              createdAt: undefined,
              fileId: 'example fileId',
              id: undefined,
              label: 'example label',
              originalCreatedAt: expect.anything(),
              originalId: 'example selection criteria id',
              updatedAt: expect.anything(),
            },
          },
          listingsLeasingAgentAddress: {
            create: {
              city: 'example city',
              county: 'example county',
              createdAt: undefined,
              id: undefined,
              latitude: 1.025,
              longitude: 1.025,
              originalCreatedAt: expect.anything(),
              originalId: 'example leasing agent address id',
              placeName: 'example placeName',
              state: 'example state',
              street: 'example street',
              street2: 'example street2',
              updatedAt: expect.anything(),
              zipCode: 'example zipCode',
            },
          },
          listingsMarketingFlyerFile: {
            create: {
              createdAt: undefined,
              fileId: 'example fileId',
              id: undefined,
              label: 'example label',
              originalCreatedAt: expect.anything(),
              originalId: 'example flyer id',
              updatedAt: expect.anything(),
            },
          },
          listingsResult: {
            create: {
              createdAt: undefined,
              fileId: 'example fileId',
              id: undefined,
              label: 'example label',
              originalCreatedAt: expect.anything(),
              originalId: 'example result id',
              updatedAt: expect.anything(),
            },
          },
          requiredDocumentsList: {
            create: {
              birthCertificate: true,
              createdAt: undefined,
              currentLandlordReference: true,
              governmentIssuedId: true,
              id: undefined,
              originalCreatedAt: expect.anything(),
              originalId: 'example required documents id',
              previousLandlordReference: true,
              proofOfAssets: true,
              proofOfCustody: true,
              proofOfIncome: true,
              residencyDocuments: true,
              socialSecurityCard: true,
              updatedAt: expect.anything(),
            },
          },
          unit: {
            create: [
              {
                accessibilityPriorityType: 'vision',
                amiChart: {
                  connect: {
                    id: 'example ami chart id',
                  },
                },
                amiPercentage: 'example amiPercentage',
                annualIncomeMax: 'example annualIncomeMax',
                annualIncomeMin: 'example annualIncomeMin',
                bmrProgramChart: true,
                createdAt: undefined,
                floor: 2,
                id: undefined,
                maxOccupancy: 3,
                minOccupancy: 4,
                monthlyIncomeMin: 5,
                monthlyRent: 6,
                monthlyRentAsPercentOfIncome: 7.05,
                numBathrooms: 8,
                numBedrooms: 9,
                number: 'example number',
                originalCreatedAt: expect.anything(),
                originalId: 'example unit id',
                sqFeet: 45.48,
                status: 'unknown',
                unitAmiChartOverride: {
                  create: {
                    createdAt: undefined,
                    id: undefined,
                    items: '[]',
                    originalCreatedAt: expect.anything(),
                    originalId: 'example override id',
                    updatedAt: expect.anything(),
                  },
                },
                unitRentType: {
                  connect: {
                    id: 'example rent type id',
                  },
                },
                unitType: {
                  connect: {
                    id: 'example unit type id',
                  },
                },
                updatedAt: expect.anything(),
              },
            ],
          },
          unitGroup: {
            create: [
              {
                accessibilityPriorityType: 'mobilityAndHearing',
                bathroomMax: 10.874,
                bathroomMin: 10.874,
                createdAt: undefined,
                flatRentValueFrom: 10.874,
                flatRentValueTo: 10.874,
                floorMax: 1,
                floorMin: 18,
                id: undefined,
                maxOccupancy: 9,
                minOccupancy: 12,
                monthlyRent: 1.54,
                openWaitlist: true,
                originalCreatedAt: expect.anything(),
                originalId: 'example unit group id 1',
                rentType: 'fixedRent',
                sqFeetMax: 874.01,
                sqFeetMin: 984.25,
                totalAvailable: 12,
                totalCount: 15,
                unitGroupAmiLevel: {
                  create: [
                    {
                      amiChart: {
                        connect: {
                          id: 'example ami chart id',
                        },
                      },
                      amiPercentage: 80,
                      createdAt: undefined,
                      flatRentValue: 65.01,
                      id: undefined,
                      monthlyRentDeterminationType: 'percentageOfIncome',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example unit group ami level id',
                      percentageOfIncomeValue: 78.4,
                      updatedAt: expect.anything(),
                    },
                  ],
                },
                unitType: {
                  connect: [
                    {
                      id: 'example unit type id 1',
                    },
                    {
                      id: 'example unit type id 2',
                    },
                  ],
                },
                updatedAt: expect.anything(),
              },
              {
                accessibilityPriorityType: 'mobilityAndHearing',
                bathroomMax: 10.874,
                bathroomMin: 10.874,
                createdAt: undefined,
                flatRentValueFrom: 10.874,
                flatRentValueTo: 10.874,
                floorMax: 1,
                floorMin: 18,
                id: undefined,
                maxOccupancy: 9,
                minOccupancy: 12,
                monthlyRent: 1.54,
                openWaitlist: true,
                originalCreatedAt: expect.anything(),
                originalId: 'example unit group id 2',
                rentType: 'fixedRent',
                sqFeetMax: 874.01,
                sqFeetMin: 984.25,
                totalAvailable: 12,
                totalCount: 15,
                unitGroupAmiLevel: {
                  create: [
                    {
                      amiChart: {
                        connect: {
                          id: 'example ami chart id',
                        },
                      },
                      amiPercentage: 80,
                      createdAt: undefined,
                      flatRentValue: 65.01,
                      id: undefined,
                      monthlyRentDeterminationType: 'percentageOfIncome',
                      originalCreatedAt: expect.anything(),
                      originalId: 'example unit group ami level id',
                      percentageOfIncomeValue: 78.4,
                      updatedAt: expect.anything(),
                    },
                  ],
                },
                unitType: {
                  connect: [
                    {
                      id: 'example unit type id 1',
                    },
                    {
                      id: 'example unit type id 2',
                    },
                  ],
                },
                updatedAt: expect.anything(),
              },
            ],
          },
        },
      });
    });
    it('should error when trying to create snapshot against listing id that does not exist', async () => {
      const id = randomUUID();

      prisma.listings.findUnique = jest.fn().mockResolvedValue(null);
      prisma.listingSnapshot.create = jest.fn().mockResolvedValue({ id });

      await expect(
        async () => await service.createListingSnapshot(id),
      ).rejects.toThrowError(
        `Snapshot was requested for listing id: ${id}, but that id does not exist`,
      );

      expect(prisma.listings.findUnique).toHaveBeenCalled();
      expect(prisma.listingSnapshot.create).not.toHaveBeenCalled();
    });
  });
});
